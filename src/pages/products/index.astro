---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// 商品データを取得
const allProducts = await getCollection('products');

// カテゴリごとに分類
const lossFlowers = allProducts.filter(p => p.data.category === 'loss_flower');
const imperfects = allProducts.filter(p => p.data.category === 'imperfect');
const markets = allProducts.filter(p => p.data.category === 'market');

// 表示順でソート
const sortByOrder = (a: any, b: any) => (a.data.order || 999) - (b.data.order || 999);
lossFlowers.sort(sortByOrder);
imperfects.sort(sortByOrder);
markets.sort(sortByOrder);
---

<Layout title="Products | Farm Eolica" description="Farm Eolicaの商品一覧。ロスフラワーから市場出荷品まで、丁寧に育てた花をお届けします。">
  <div class="pt-32 pb-24 min-h-screen">
    <!-- Hero Section -->
    <section class="mb-32" data-animate>
      <div class="max-w-7xl mx-auto px-6 lg:px-12 text-center">
        <p class="font-mono text-xs tracking-widest text-warm-gray-500 mb-4">
          OUR FLOWERS
        </p>
        <h1 class="font-display text-5xl md:text-7xl tracking-wide text-dark-slate mb-6">
          Products
        </h1>
        <p class="text-lg text-warm-gray-600 max-w-2xl mx-auto leading-relaxed font-serif">
          規格外の花から市場品質まで。<br />
          Farm Eolicaが丁寧に育てた花たちをご紹介します。
        </p>
      </div>
    </section>

    <!-- Loss Flowers Section -->
    {lossFlowers.length > 0 && (
      <section class="mb-32" data-animate>
        <div class="max-w-7xl mx-auto px-6 lg:px-12">
          <div class="mb-12">
            <p class="font-mono text-xs tracking-widest text-rust mb-2">
              LOSS FLOWERS
            </p>
            <h2 class="font-serif text-3xl md:text-4xl text-dark-slate mb-4">
              ロスフラワー
            </h2>
            <p class="text-warm-gray-600 leading-relaxed max-w-2xl">
              市場に出せない規格外の花たち。少し形が違うだけで、美しさに変わりはありません。
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {lossFlowers.map((product) => (
              <a
                href={`/products/${product.slug}`}
                class="group block bg-stone-white/95 backdrop-blur-sm shadow-lab-lg overflow-hidden hover:shadow-xl transition-all duration-300"
              >
                <div class="aspect-[4/3] overflow-hidden bg-warm-gray-100">
                  <img
                    src={product.data.image.src}
                    alt={product.data.name}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                    loading="lazy"
                  />
                </div>
                <div class="p-6">
                  <h3 class="font-serif text-xl text-dark-slate mb-2 group-hover:text-lab-green transition-colors">
                    {product.data.name}
                  </h3>
                  <p class="text-sm text-warm-gray-600 mb-4 line-clamp-2 leading-relaxed">
                    {product.data.description}
                  </p>
                  <div class="flex items-center justify-between">
                    <p class="font-mono text-lg text-rust">
                      ¥{product.data.price.toLocaleString()}
                      <span class="text-xs text-warm-gray-500 ml-1">/ {product.data.unit}</span>
                    </p>
                    {!product.data.inStock && (
                      <span class="font-mono text-xs text-warm-gray-400">SOLD OUT</span>
                    )}
                  </div>
                </div>
              </a>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- Imperfect Section -->
    {imperfects.length > 0 && (
      <section class="mb-32" data-animate>
        <div class="max-w-7xl mx-auto px-6 lg:px-12">
          <div class="mb-12">
            <p class="font-mono text-xs tracking-widest text-rust mb-2">
              IMPERFECT
            </p>
            <h2 class="font-serif text-3xl md:text-4xl text-dark-slate mb-4">
              規格外品
            </h2>
            <p class="text-warm-gray-600 leading-relaxed max-w-2xl">
              市場規格には満たないものの、品質・美しさは変わらない花たちです。
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {imperfects.map((product) => (
              <a
                href={`/products/${product.slug}`}
                class="group block bg-stone-white/95 backdrop-blur-sm shadow-lab-lg overflow-hidden hover:shadow-xl transition-all duration-300"
              >
                <div class="aspect-[4/3] overflow-hidden bg-warm-gray-100">
                  <img
                    src={product.data.image.src}
                    alt={product.data.name}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                    loading="lazy"
                  />
                </div>
                <div class="p-6">
                  <h3 class="font-serif text-xl text-dark-slate mb-2 group-hover:text-lab-green transition-colors">
                    {product.data.name}
                  </h3>
                  <p class="text-sm text-warm-gray-600 mb-4 line-clamp-2 leading-relaxed">
                    {product.data.description}
                  </p>
                  <div class="flex items-center justify-between">
                    <p class="font-mono text-lg text-rust">
                      ¥{product.data.price.toLocaleString()}
                      <span class="text-xs text-warm-gray-500 ml-1">/ {product.data.unit}</span>
                    </p>
                    {!product.data.inStock && (
                      <span class="font-mono text-xs text-warm-gray-400">SOLD OUT</span>
                    )}
                  </div>
                </div>
              </a>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- Market Section -->
    {markets.length > 0 && (
      <section class="mb-32" data-animate>
        <div class="max-w-7xl mx-auto px-6 lg:px-12">
          <div class="mb-12">
            <p class="font-mono text-xs tracking-widest text-rust mb-2">
              MARKET GRADE
            </p>
            <h2 class="font-serif text-3xl md:text-4xl text-dark-slate mb-4">
              市場出荷品
            </h2>
            <p class="text-warm-gray-600 leading-relaxed max-w-2xl">
              市場に出荷している最高品質の花です。在庫状況により直接販売できる場合がございます。
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {markets.map((product) => (
              <a
                href={`/products/${product.slug}`}
                class="group block bg-stone-white/95 backdrop-blur-sm shadow-lab-lg overflow-hidden hover:shadow-xl transition-all duration-300"
              >
                <div class="aspect-[4/3] overflow-hidden bg-warm-gray-100">
                  <img
                    src={product.data.image.src}
                    alt={product.data.name}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                    loading="lazy"
                  />
                </div>
                <div class="p-6">
                  <h3 class="font-serif text-xl text-dark-slate mb-2 group-hover:text-lab-green transition-colors">
                    {product.data.name}
                  </h3>
                  <p class="text-sm text-warm-gray-600 mb-4 line-clamp-2 leading-relaxed">
                    {product.data.description}
                  </p>
                  <div class="flex items-center justify-between">
                    <p class="font-mono text-lg text-rust">
                      ¥{product.data.price.toLocaleString()}
                      <span class="text-xs text-warm-gray-500 ml-1">/ {product.data.unit}</span>
                    </p>
                    {!product.data.inStock && (
                      <span class="font-mono text-xs text-warm-gray-400">SOLD OUT</span>
                    )}
                  </div>
                </div>
              </a>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- Contact Section -->
    <section class="max-w-4xl mx-auto px-6 lg:px-12 text-center" data-animate>
      <div class="bg-stone-white/95 backdrop-blur-sm p-12 shadow-lab-lg">
        <p class="font-mono text-xs tracking-widest text-warm-gray-500 mb-4">
          CONTACT
        </p>
        <h2 class="font-serif text-2xl md:text-3xl text-dark-slate mb-6">
          ご購入・お問い合わせ
        </h2>
        <p class="text-warm-gray-600 leading-relaxed mb-8">
          商品の在庫状況や配送についてのご質問は、<br />
          お気軽にLINE公式アカウントまたはお問い合わせフォームからご連絡ください。
        </p>
        <div class="flex gap-4 justify-center flex-wrap">
          <a
            href="#"
            class="inline-block px-8 py-3 text-xs tracking-widest uppercase font-mono border-2 border-rust hover:bg-rust hover:text-white transition-all duration-300"
          >
            LINE で問い合わせ
          </a>
          <a
            href="#"
            class="inline-block px-8 py-3 text-xs tracking-widest uppercase font-mono border-2 border-lab-green hover:bg-lab-green hover:text-white transition-all duration-300"
          >
            フォームで問い合わせ
          </a>
        </div>
      </div>
    </section>
  </div>
</Layout>
